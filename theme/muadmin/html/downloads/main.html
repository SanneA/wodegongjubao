<style>
    .newslevel{
        height: 27px;
        width:100%;
        margin-bottom: 5px;

    }
    .newslevel:hover{
        background-color: rgba(166, 255, 157, 0.46);
    }
</style>

<table style="margin: 0 auto;">
    <tr>
        <td>
            <form method="POST" id="newsform_">
                <table class="table table-striped" style="width: 99%">
                    <tr >
                        <input type="text" name="ntitlez" id="ntitlez" placeholder="|l_ntitle|" style="width:100%" maxlength="255">
                    </tr>
                    <tr>
                        <td colspan="2"><textarea style="width:100%; height:150px;" id="newsinput" name="newsinput" ></textarea></td>
                    </tr>
                    <td>
                        <input type="text" class="w-input" name="ntag" id="ntag" placeholder="|l_nttags|" style="width:100%" maxlength="255">
                    </td>
                    <tr>
                        <td style="text-align: center"> <input class="button add" type="button" name="add_n" value="|l_btdad|" onclick="addorapply()"> <input class="button add" type="button" name="add_n" value="|l_new|" onclick="clearnews();"></td>
                    </tr>
                </table>
            </form>
        </td>
    </tr>
    <tr>
        <td><fieldset style="width: 100%; border: 1px gray solid;padding:6px;border-radius: 5px;"><legend style="margin: 0 5px;padding: 0 2px;">|l_nlegend|</legend><Span id="newslist">|newshistory|</Span></fieldset></td>

    </tr>
</table>
<script type="text/javascript">
    var edit;
    $(document).ready( function(){
                edit=CKEDITOR.replace('newsinput',{
                    fillEmptyBlocks: false,
                    fullPage: false
                })
    });
    currentNews = 0;


    function getNews(id)
    {
        genIn({
            noresponse:true,
            address:"|site|control.php?p=downloads&bg=1&a=getnums&get="+id,
            callback:function(response){
                if(response.trim().length > 0) {

                    var answer = response.split("_+separator+_");
                    /**
                     * 0 col_id                     *
                     * 1 col_title
                     * 2 col_desc
                     * 3 col_address
                     * 4 col_pik
                     */
                    currentNews = answer[0];
                    CKEDITOR.instances["newsinput"].setData(answer[2]);
                    document.getElementById("ntitlez").value = answer[4];
                    document.getElementById("ntag").value = answer[3];
                }
                else
                    Apprise('|l_errs|');
            }
        });
    }

    function clearnews()
    {
        currentNews=0;
        CKEDITOR.instances["newsinput"].setData(" ");
        document.getElementById("ntitlez").value = "";
        document.getElementById("ntag").value = "";
    }

    function addorapply()
    {
        for(var editor in CKEDITOR.instances) {
            CKEDITOR.instances[editor].updateElement();
        }
        if(currentNews>0)
        {
            $.ajax({
                url: "|site|control.php?p=downloads&bg=1&a=apply",
                type: 'POST',
                data: $("#newsform_").serialize() + "&id=" + currentNews,
                cache: false,
                success: function () {
                    clearnews();
                    getnList();

                },
                error: function () {
                    Apprise("|l_errs|");
                }
            });
        }
        else
        {
            $.ajax({
                url: "|site|control.php?p=downloads&bg=1&a=newnews",
                type: 'POST',
                data: $("#newsform_").serialize() + "&newsinput="+CKEDITOR.instances["newsinput"].getData(),
                cache: false,
                success: function () {
                    clearnews();
                    getnList();

                },
                error: function () {
                    Apprise("|l_errs|");
                }
            });
        }

    }

    function delnews(id)
    {

            $.ajax({
                url: "|site|control.php?p=downloads&bg=1&a=delnews",
                type: 'POST',
                data: "&id=" + id,
                cache: false,
                success: function () {
                    clearnews();
                    getnList();
                    Apprise("|l_delnew|",{animation:0});
                },
                error: function () {
                    Apprise("|l_errs|");
                }
            });


    }

    function getnList()
    {
        genIn({
            element:"newslist",
            address:"|site|control.php?p=downloads&bg=1&a=bglist",
            loadicon:'<img src=\"theme/imgs/likewin.gif\" border="0" alt="0" align="center"/>'
        });
    }
</script>